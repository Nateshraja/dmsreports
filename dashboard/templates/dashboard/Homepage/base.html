{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{% static 'images/DMSLogo.JPG' %}">
    <title>{% block title %}DMS Dashboard{% endblock %}</title>
  <!-- Google Fonts-->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
 
  <!-- Vendor CSS Files -->
  <link  rel="stylesheet" href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'vendor/bootstrap-icons/bootstrap-icons.css' %}">
  <script src="{% static 'vendor/tinymce/tinymce.js' %}"></script>
  <script src="{% static 'vendor/tinymce/tinymce.min.js' %}"></script>
  <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">

<!-- Load jQuery FIRST -->
<script src="{% static 'node_modules/jquery/dist/jquery.min.js' %}"></script>

<!-- Load Select2 -->
<script src="{% static 'node_modules/select2/dist/js/select2.min.js' %}"></script>

<!-- Load Chart.js -->
<script src="{% static 'vendor/chart.js/dist/chart.umd.js' %}"></script>

<!-- Select2 CSS -->
<link rel="stylesheet" href="{% static 'node_modules/select2/dist/css/select2.min.css' %}">


<!-- Load Chart.js Plugins -->
<script src="{% static 'vendor/chartjs-plugin-datalabels/dist/chartjs-plugin-datalabels.js' %}"></script>

    <!-- Bootstrap CSS JS Bundle
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    -->
    <script src="{% static 'js/flexmonster_init.js' %}"></script>
    <!-- Flexmonster CSS JS Bundle -->
    <script src="{% static 'flexmonster/flexmonster.full.js' %}"></script>
    <script src="{% static 'flexmonster/flexmonster.js' %}"></script>
    <link rel="stylesheet" href="{% static 'flexmonster/flexmonster.css' %}">
    <link rel="stylesheet" href="{% static 'flexmonster/flexmonster.min.css' %}">
    <script src="{% static 'flexmonster/toolbar/flexmonster.toolbar.js' %}"></script>

    <link rel="stylesheet" href="{% static 'flexmonster/theme/lightblue/flexmonster.css' %}">

    <!-- External CSS -->
    <link rel="stylesheet" href="{% static 'css/external_css.css' %}">
    <link rel="stylesheet" href="{% static 'css/analytics.css' %}">

    <link rel="stylesheet" href="{% static 'css/jquery.dataTables.min.css' %}">

    <!-- fontawesome CSS -->
    <link rel="stylesheet" href="{% static 'fontawesome/css/all.min.css' %}">


    <script></script>
    <style>

</style>
</head>
<body>


        <!-- ======= Header ======= -->
        <header id="header" class="header fixed-top d-flex align-items-center">
      
          <div class="d-flex align-items-center justify-content-between">
            <a href="{% url 'dmsdashboard' %}" class="logo d-flex align-items-center">
              <img src="{% static 'images/DMSLogo.JPG' %}" alt="">
              <span class="d-none d-lg-block">&nbsp;D&nbsp;M&nbsp;S</span>
            </a>
            <i class="bi bi-list toggle-sidebar-btn"></i>
          </div><!-- End Logo -->
          <!--
          <div class="search-bar">
            <form class="search-form d-flex align-items-center" method="POST" action="#">
              <input type="text" name="query" placeholder="Search" title="Enter search keyword">
              <button type="submit" title="Search"><i class="bi bi-search"></i></button>
            </form>
          </div> End Search Bar -->
      
          <nav class="header-nav ms-auto">
            <ul class="d-flex align-items-center">
      
                <li class="nav-item dropdown pe-3">
                    <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                    <img src="{% static 'assets/img/profile-img.jpg' %}" alt="Profile" class="rounded-circle">
                    <span class="d-none d-md-block dropdown-toggle ps-2" id="profile-display-name">{{param3}}
                    </span>
                    </a><!-- End Profile Iamge Icon -->
                      
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                        <li class="dropdown-header">
                            <h6 id="profile-display-name1">{{param3}}</h6>
                            <span id="profile-cardcode">{{param1}}</span>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="/testdashboard/">
                                <i class="bi bi-box-arrow-right"></i>
                                <span>Sign Out</span>
                            </a>
                        </li>
                    </ul><!-- End Profile Dropdown Items -->
                </li><!-- End Profile Nav -->
            </ul>
          </nav><!-- End Icons Navigation -->
      
        </header><!-- End Header -->
      
        <!-- ======= Sidebar ======= -->
        <aside id="sidebar" class="sidebar">
      
          <ul class="sidebar-nav" id="sidebar-nav">
      
            <li class="nav-item">
              <a class="nav-link " href="{% url 'dmsdashboard' %}">
                <!--<i class="bi bi-grid"></i>-->
                <span>Dashboard</span>
              </a>
            </li><!-- End Dashboard Nav -->
      
            <!--<li class="nav-item">
              <a class="nav-link collapsed custom-menu-icon" data-bs-target="#report-nav" data-bs-toggle="collapse" href="#">
                <span>Reports</span><i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="report-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
                <li>
                  <a href="{% url 'stock_report' %}">
                    <i class="bi bi-arrow-right-square"></i><span>Available Stock</span>
                  </a>
                </li>
                <li>
                  <a href="{% url 'sales_invoice' %}">
                    <i class="bi bi-arrow-right-square"></i><span>Invoice Report</span>
                  </a>
                </li>
               </ul>
            </li>-->
            <li class="nav-item">
              <a class="nav-link reports custom-menu-icon  {% if request.resolver_match.url_name in 'stock_report sales_invoice' %} active {% endif %}" 
                 data-bs-toggle="collapse" href="#report-nav">
                  <span>Reports</span><i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="report-nav" class="nav-content collapse {% if request.resolver_match.url_name in 'stock_report sales_invoice' %} show {% endif %}" 
                  data-bs-parent="#sidebar-nav">
                  <li>
                      <a href="{% url 'stock_report' %}" class="{% if request.resolver_match.url_name == 'stock_report' %} active {% endif %}">
                          <i class="bi bi-arrow-right-square"></i><span>Available Stock</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'sales_invoice' %}" class="{% if request.resolver_match.url_name == 'sales_invoice' %} active {% endif %}">
                          <i class="bi bi-arrow-right-square"></i><span>Invoice Report</span>
                      </a>
                  </li>
              </ul>
          </li>
          
            <li class="nav-item">
              <a class="nav-link masters custom-menu-icon  {% if request.resolver_match.url_name in 'customers products' %} active {% endif %}"
                 data-bs-toggle="collapse" href="#masters-nav">
                  <span>Masters</span>
                  <i class="bi bi-chevron-down ms-auto"></i>
              </a>
              <ul id="masters-nav" class="nav-content collapse {% if request.resolver_match.url_name in 'customers products' %} show {% endif %}" data-bs-parent="#sidebar-nav">
                  <li>
                      <a href="{% url 'customers' %}" class="{% if request.resolver_match.url_name == 'customers' %} active {% endif %}">
                          <i class="bi bi-arrow-right-square"></i><span>Customers</span>
                      </a>
                  </li>
                  <li>
                      <a href="{% url 'products' %}" class="{% if request.resolver_match.url_name == 'products' %} active {% endif %}">
                          <i class="bi bi-arrow-right-square"></i><span>Products</span>
                      </a>
                  </li>
              </ul>
          </li>          
          <li class="nav-item">
            <a class="nav-link analytics custom-menu-icon  {% if request.resolver_match.url_name == 'sales_chart' %} active {% endif %}"
               data-bs-toggle="collapse" href="#analytics-nav">
                <span>Analytics</span>
                <i class="bi bi-chevron-down ms-auto"></i>
            </a>
            <ul id="analytics-nav" class="nav-content collapse {% if request.resolver_match.url_name == 'sales_chart' %} show {% endif %}" data-bs-parent="#sidebar-nav">
                <li>
                    <a href="{% url 'sales_chart' %}" class="{% if request.resolver_match.url_name == 'sales_chart' %} active {% endif %}">
                        <i class="bi bi-arrow-right-square"></i><span>Sales Data Chart</span>
                    </a>
                </li>
                <!--<li>
                    <a href="{% url 'purchase_chart' %}" class="{% if request.resolver_match.url_name == 'purchase_chart' %} active {% endif %}">
                        <i class="bi bi-arrow-right-square"></i><span>Purchase Data Chart</span>
                    </a>
                </li>-->
                <li>
                    <a href="{% url 'stock_chart' %}" class="{% if request.resolver_match.url_name == 'stock_chart' %} active {% endif %}">
                        <i class="bi bi-arrow-right-square"></i><span>Stock Data Chart</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'sales_qty_pivot' %}" class="{% if request.resolver_match.url_name == 'sales_qty_pivot' %} active {% endif %}">
                        <i class="bi bi-arrow-right-square"></i><span>Sales Qty Comparison</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'sales_value_pivot' %}" class="{% if request.resolver_match.url_name == 'sales_value_pivot' %} active {% endif %}">
                        <i class="bi bi-arrow-right-square"></i><span>Sales Value Comparison</span>
                    </a>
                </li>
                <li>
                    <a href="{% url 'sales_summary_pivot' %}" class="{% if request.resolver_match.url_name == 'sales_summary_pivot' %} active {% endif %}">
                        <i class="bi bi-arrow-right-square"></i><span>Sales Comparison Summary</span>
                    </a>
                </li>
            </ul>
        </li>
        
          </ul>
      
        </aside><!-- End Sidebar-->
      
 <main id="main" class="main">
    {% block content %}
    {% endblock %}
</main>
  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
      &copy; Copyright <strong><span>RamrajCotton</span></strong>. All Rights Reserved
    </div>
    <div class="credits">

    </div>
  </footer>

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        function fetchDistributorName(param1, param2) {
    if (param1 && param2) {
        // Construct the query string with both parameters
        const url = `/get_distributor_display_name/?param1=${param1}&param2=${param2}`;
       // console.log(typeof jQuery);        Should print "function"
//console.log(typeof $.fn.select2);  Should print "function"

        // Fetch distributor display name from the server
            fetch(url)
                    .then(response => {
                        // Check if the response is OK
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.distributor_name) {
                            // Get the element to display the distributor name
                            const profileDisplayName = document.getElementById('profile-display-name');
                            const profileDisplayName1 = document.getElementById('profile-display-name1');
                            const profileCardCode = document.getElementById('profile-cardcode');

                            // Ensure the element exists before updating it
                            if (profileDisplayName) {
                                profileDisplayName.innerText = data.distributor_name;
                            } 
                            if (profileDisplayName1) {
                                profileDisplayName1.innerText = data.distributor_name;
                            } 
                            if (profileCardCode) {
                                profileCardCode.innerText = `${param1}`;
                            }
                            else {
                                console.error("Element with ID 'profile-display-name' not found.");
                            }
                        } else {
                            console.error("No distributor_name found in the response.");
                        }
                    })
                    .catch(error => console.error('Error fetching distributor name:', error));
            } else {
                console.error('Both param1 and param2 are required.');
            }
        }
        const param1 = getUrlParameter('param1');
        const param2 = getUrlParameter('param2');

    if (param1 && param2) {
          // Set session parameters and then initialize the dashboard
          setSessionParameters(param1, param2).then(() => {
              initializeDashboard({ param1, param2 });
          });
      } else {
          // Fetch session parameters from the server if not provided in URL
          fetch('/get_session/')
              .then(response => {
                  if (!response.ok) {
                      throw new Error('Failed to retrieve session parameters');
                  }
                  return response.json();
              })
              .then(sessionParams => {
                  if (sessionParams.param1 && sessionParams.param2) {
                      initializeDashboard(sessionParams);
                  } else {
                      console.error('Session parameters missing. Cannot initialize the dashboard.');
                  }
              })
              .catch(error => console.error('Error fetching session parameters:', error));
      }
        // Highlight active sidebar link
        setActiveSidebarLink();
    });
    document.addEventListener('contextmenu', (event) => {
            event.preventDefault();
            alert('Right-click is disabled on this page.');
        });
</script>
<!-- Vendor JS Files -->
<script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

<!-- Template Main JS File -->
<script src="{% static 'assets/js/main.js' %}"></script>
<script src="{% static 'js/basefunction.js' %}"></script>
<script src="{% static 'js/allcharts.js' %}"></script>
<script src="{% static 'js/salesdatacharts.js' %}"></script>
<script src="{% static 'js/stockdatacharts.js' %}"></script>  <!---->
<script src="{% static 'js/stockdatatablecharts.js' %}"></script>
<script src="{% static 'js/jspdf.umd.min.js' %}"></script><!---->
<script src="{% static 'js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'js/html2canvas.min.js' %}"></script>

</body>
</html>
